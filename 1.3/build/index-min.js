/*! switchable - v1.3 - 2013-05-27 12:45:13 PM
* Copyright (c) 2013 yiminghe; Licensed  */
KISSY.add("gallery/switchable/1.3/base",function(e,t,n,i){function a(n,a){var r=this;r._triggerInternalCls=e.guid(I),r._panelInternalCls=e.guid(T),a=a||{},"markupType"in a||(a.panelCls?a.markupType=1:a.panels&&(a.markupType=2));for(var s=r.constructor;s;)a=e.merge(s.Config,a),s=s.superclass?s.superclass.constructor:null;r.container=t.get(n),r.config=a,r.activeIndex=a.activeIndex;var c;r.activeIndex>-1||("number"==typeof a.switchTo?c=a.switchTo:r.activeIndex=0),r._init(),r._initPlugins(),r.fire(v),c!==i&&r.switchTo(c)}function r(e){if(e&&e.length){if(1==e.length)return e[0].parentNode;for(var n=e[0],i=0;!i&&n!=document.body;){n=n.parentNode,i=1;for(var a=1;e.length>a;a++)if(!t.contains(n,e[a])){i=0;break}}return n}return null}function s(e){var t={};return t.type=e.type,t.target=e.target,{originalEvent:t}}var c="display",o="block",l=e.makeArray,u="none",f=n.Target,g="forward",d="backward",h=".",v="init",p="beforeSwitch",m="switch",b="beforeRemove",y="add",x="remove",w="ks-switchable-",I=w+"trigger-internal",T=w+"panel-internal";return a.getDomEvent=s,a.addPlugin=function(e,t){t=t||a;for(var n=e.priority=e.priority||0,i=0,r=t.Plugins=t.Plugins||[];r.length>i&&!(n>r[i].priority);i++);r.splice(i,0,e)},a.Config={markupType:0,navCls:w+"nav",contentCls:w+"content",triggerCls:w+"trigger",panelCls:w+"panel",triggers:[],panels:[],hasTriggers:!0,triggerType:"mouse",delay:.1,activeIndex:-1,activeTriggerCls:"ks-active",switchTo:i,steps:1,viewSize:[]},e.augment(a,f,{_initPlugins:function(){for(var t=this,n=[],i=t.constructor;i;)i.Plugins&&n.push.apply(n,[].concat(i.Plugins).reverse()),i=i.superclass?i.superclass.constructor:null;n.reverse(),e.each(n,function(e){e.init&&e.init(t)})},_init:function(){var e=this,t=e.config;e._parseMarkup(),t.hasTriggers&&e._bindTriggers(),e._bindPanels()},_parseMarkup:function(){var e,n,i,a=this,s=a.container,c=a.config,o=[],u=[];switch(c.markupType){case 0:e=t.get(h+c.navCls,s),e&&(o=t.children(e)),n=t.get(h+c.contentCls,s),u=t.children(n);break;case 1:o=t.query(h+c.triggerCls,s),u=t.query(h+c.panelCls,s);break;case 2:o=c.triggers,u=c.panels,e=c.nav,n=c.content}i=u.length,a.length=Math.ceil(i/c.steps),a.nav=e||c.hasTriggers&&r(o),!c.hasTriggers||a.nav&&0!=o.length||(o=a._generateTriggersMarkup(a.length)),a.triggers=l(o),a.panels=l(u),a.content=n||r(u)},_generateTriggersMarkup:function(e){var n,i,a=this,r=a.config,s=a.nav||t.create("<ul>");for(s.className=r.navCls,i=0;e>i;i++)n=t.create("<li>"),i===a.activeIndex&&(n.className=r.activeTriggerCls),n.innerHTML=i+1,s.appendChild(n);return a.container.appendChild(s),a.nav=s,t.children(s)},_bindTriggers:function(){var t=this,i=t.config,a=t._triggerInternalCls,r=t.nav,s=t.triggers;e.each(s,function(e){t._initTrigger(e)}),n.delegate(r,"click","."+a,function(e){var n=e.currentTarget,i=t._getTriggerIndex(n);t._onFocusTrigger(i,e)}),"mouse"===i.triggerType&&(n.delegate(r,"mouseenter","."+a,function(e){var n=e.currentTarget,i=t._getTriggerIndex(n);t._onMouseEnterTrigger(i,e)}),n.delegate(r,"mouseleave","."+a,function(){t._onMouseLeaveTrigger()}))},_initTrigger:function(e){t.addClass(e,this._triggerInternalCls)},_bindPanels:function(){var t=this,n=t.panels;e.each(n,function(e){t._initPanel(e)})},_initPanel:function(e){t.addClass(e,this._panelInternalCls)},_onFocusTrigger:function(e,t){var n=this;n._triggerIsValid(e)&&(this._cancelSwitchTimer(),n.switchTo(e,i,s(t)))},_onMouseEnterTrigger:function(t,n){var a=this;if(a._triggerIsValid(t)){var r=s(n);a.switchTimer=e.later(function(){a.switchTo(t,i,r)},1e3*a.config.delay)}},_onMouseLeaveTrigger:function(){this._cancelSwitchTimer()},_triggerIsValid:function(e){return this.activeIndex!==e},_cancelSwitchTimer:function(){var e=this;e.switchTimer&&(e.switchTimer.cancel(),e.switchTimer=i)},_getTriggerIndex:function(t){var n=this;return e.indexOf(t,n.triggers)},_resetLength:function(){this.length=this._getLength()},_getLength:function(e){var t=this,n=t.config;return e===i&&(e=t.panels.length),Math.ceil(e/n.steps)},_afterAdd:function(e,t,n){var a=this;a._resetLength();var r=a._getLength(e+1)-1;1==a.config.steps&&a.activeIndex>=r&&(a.activeIndex+=1);var s=a.activeIndex;a.activeIndex=-1,a.switchTo(s),t?a.switchTo(r,i,i,n):n()},add:function(n){var i=n.callback||e.noop,a=this,r=a.nav,s=a.content,c=n.trigger,o=n.panel,l=n.active,u=a.panels.length,f=null!=n.index?n.index:u,g=a.triggers,d=a.panels,h=a.length,v=null,p=null;f=Math.max(0,Math.min(f,u));var m=d[f]||null;d.splice(f,0,o),s.insertBefore(o,m),1==a.config.steps?(p=g[f]||null,r.insertBefore(c,p),g.splice(f,0,c)):(v=a._getLength(),v!=h&&(t.append(c,r),g.push(c))),a._initPanel(o),a._initTrigger(c),a._afterAdd(f,l,i),a.fire(y,{index:f,trigger:c,panel:o})},remove:function(n){function a(){if(h&&(t.remove(h),u.splice(r,1)),d){t.remove(d);for(var e=0;g.length>e;e++)if(g[e]==d){c.triggers.splice(e,1);break}}c._resetLength(),c.fire(x,{index:r,trigger:d,panel:h})}var r,s=n.callback||e.noop,c=this,o=c.config.steps,l=c.length,u=c.panels;r="index"in n?n.index:n.panel;var f=c._getLength(u.length-1),g=c.triggers,d=null,h=null;if(u.length&&(r=e.isNumber(r)?Math.max(0,Math.min(r,u.length-1)):e.indexOf(r,u),d=1==o?g[r]:f!==l?g[l-1]:null,h=u[r],c.fire(b,{index:r,panel:h,trigger:d})!==!1)){if(0==f)return a(),s(),i;var v=c.activeIndex;if(o>1)return v==f?c.switchTo(v-1,i,i,function(){a(),s()}):(a(),c.activeIndex=-1,c.switchTo(v,i,i,function(){s()})),i;if(v==r){var p=v>0?v-1:v+1;c.switchTo(p,i,i,function(){a(),0==v&&(c.activeIndex=0),s()})}else v>r&&(v--,c.activeIndex=v),a(),s()}},switchTo:function(e,t,n,a){var r=this,s=r.config,c=r.activeIndex,o=r.triggers;return r._triggerIsValid(e)?r.fire(p,{fromIndex:c,toIndex:e})===!1?r:(r.fromIndex=c,s.hasTriggers&&r._switchTrigger(o[c]||null,o[e]),t===i&&(t=e>c?g:d),r.activeIndex=e,r._switchView(t,n,function(){a&&a.call(r)}),r):r},_switchTrigger:function(e,n){var i=this.config.activeTriggerCls;e&&t.removeClass(e,i),t.addClass(n,i)},_getFromToPanels:function(){var e,t,n=this,i=n.fromIndex,a=n.config.steps,r=n.panels,s=n.activeIndex;return e=i>-1?r.slice(i*a,(i+1)*a):null,t=r.slice(s*a,(s+1)*a),{fromPanels:e,toPanels:t}},_switchView:function(e,n,i){var a=this,r=a._getFromToPanels(),s=r.fromPanels,l=r.toPanels;s&&t.css(s,c,u),t.css(l,c,o),setTimeout(function(){a._fireOnSwitch(n)},0),i&&i.call(this)},_fireOnSwitch:function(t){var n=this;n.fire(m,e.merge(t,{fromIndex:n.fromIndex,currentIndex:this.activeIndex}))},prev:function(e){var t=this;t.switchTo((t.activeIndex-1+t.length)%t.length,d,e)},next:function(e){var t=this;t.switchTo((t.activeIndex+1)%t.length,g,e)},destroy:function(i){for(var a=this,r=a.constructor;r;)e.each(r.Plugins,function(e){e.destroy&&e.destroy(a)}),r=r.superclass?r.superclass.constructor:null;i?(n.remove(a.container),a.content&&n.remove(a.content),a.nav&&n.remove(a.nav)):t.remove(a.container),a.nav=null,a.content=null,a.container=null,a.triggers=[],a.panels=[],a.detach()}}),a},{requires:["dom","event"]}),KISSY.add("gallery/switchable/1.3/accordion/base",function(e,t,n){function i(e,t){var n=this;return n instanceof i?(i.superclass.constructor.apply(n,arguments),void 0):new i(e,t)}return e.extend(i,n,{_switchTrigger:function(e,n){var a=this,r=a.config;r.multiple?t.toggleClass(n,r.activeTriggerCls):i.superclass._switchTrigger.apply(a,arguments)},_triggerIsValid:function(e){return this.config.multiple||i.superclass._triggerIsValid.call(this,e)},_switchView:function(e,n,a){var r=this,s=r.config,c=r._getFromToPanels().toPanels;s.multiple?(t.toggle(c),this._fireOnSwitch(n),a&&a.call(this)):i.superclass._switchView.apply(r,arguments)}}),i.Config={markupType:1,triggerType:"click",multiple:!1},i},{requires:["dom","../base"]}),KISSY.add(function(e,t,n,i){function a(e,t){var n=this;return n instanceof a?(a.superclass.constructor.apply(n,arguments),void 0):new a(e,t)}var r="ks-switchable-",s=".",c="added",o="removed",l="prevBtn",u="nextBtn",f={originalEvent:{target:1}};return a.Config={circular:!0,prevBtnCls:r+"prev-btn",nextBtnCls:r+"next-btn",disableBtnCls:r+"disable-btn"},e.extend(a,i,{_init:function(){function i(e){t.removeClass([r[l],r[u]],d),0==e&&t.addClass(r[l],d),e==r.length-1&&t.addClass(r[u],d)}var r=this;a.superclass._init.call(r);var g=r.config,d=g.disableBtnCls;e.each(["prev","next"],function(e){var i=r[e+"Btn"]=t.get(s+g[e+"BtnCls"],r.container);n.on(i,"mousedown",function(t){t.preventDefault();var n=r.activeIndex;"prev"!=e||0==n&&!g.circular||r[e](f),"next"!=e||n==r.length-1&&!g.circular||r[e](f)})}),g.circular||(r.on(c+" "+o,function(){i(r.activeIndex)}),r.on("switch",function(e){i(e.currentIndex)})),n.delegate(r.content,"click",s+r._panelInternalCls,function(e){var t=e.currentTarget;r.fire("itemSelected",{item:t})})},destroy:function(e){var t=this;e&&(t.nextBtn&&n.remove(t.nextBtn),t.prevBtn&&n.remove(t.prevBtn)),a.superclass.destroy.apply(t,arguments)}}),a},{requires:["dom","event","../base"]}),KISSY.add("gallery/switchable/1.3/slide/base",function(e,t){function n(e,t){var i=this;return i instanceof n?(n.superclass.constructor.apply(i,arguments),void 0):new n(e,t)}return n.Config={autoplay:!0,circular:!0},e.extend(n,t),n},{requires:["../base"]}),KISSY.add("gallery/switchable/1.3/tabs/base",function(e,t){function n(e,t){var i=this;return i instanceof n?(n.superclass.constructor.call(i,e,t),0):new n(e,t)}return e.extend(n,t),n.Config={},n},{requires:["../base"]}),KISSY.add("gallery/switchable/1.3/lazyload",function(e,t,n){var i="beforeSwitch",a="img",r="textarea",s={};return s[a]="lazyImgAttribute",s[r]="lazyTextareaClass",e.mix(n.Config,{lazyImgAttribute:"data-ks-lazyload-custom",lazyTextareaClass:"ks-datalazyload-custom",lazyDataType:r}),n.addPlugin({name:"lazyload",init:function(n){function c(e){var t=n._realStep||f.steps,a=e.toIndex*t,r=a+t;u.loadCustomLazyData(n.panels.slice(a,r),g,l),o()&&n.detach(i,c)}function o(){var e,i,s,c,o=g===a,u=o?"img":g===r?"textarea":"";if(u)for(e=t.query(u,n.container),i=0,c=e.length;c>i;i++)if(s=e[i],o?t.attr(s,l):t.hasClass(s,l))return!1;return!0}var l,u=e.require("datalazyload"),f=n.config,g=f.lazyDataType;"img-src"===g?g=a:"area-data"===g&&(g=r),f.lazyDataType=g,l=f[s[g]],u&&g&&l&&(n.on(i,c),c({toIndex:n.activeIndex}))}}),n},{requires:["dom","./base"]}),KISSY.add("gallery/switchable/1.3/effect",function(e,t,n,i,a,r){var s,c="display",o="block",l="none",u="opacity",f="z-index",g="position",d="relative",h="absolute",v="scrollx",p="scrolly",m="fade",b="left",y="top",x="float",w="px";return e.mix(a.Config,{effect:l,duration:.5,easing:"easeNone"}),a.Effects={none:function(e){var n=this,i=n._getFromToPanels(),a=i.fromPanels,r=i.toPanels;a&&t.css(a,c,l),t.css(r,c,o),e&&e()},fade:function(n){var a=this,s=a._getFromToPanels(),c=s.fromPanels,o=s.toPanels;c&&1!==c.length&&e.error("fade effect only supports steps == 1.");var l=a.config,g=c?c[0]:null,d=o[0];a.anim&&(a.anim.stop(),t.css(a.anim.fromEl,{zIndex:1,opacity:0}),t.css(a.anim.toEl,"zIndex",9)),t.css(d,u,1),g?(a.anim=new i(g,{opacity:0},l.duration,l.easing,function(){a.anim=r,t.css(d,f,9),t.css(g,f,1),n&&n()}).run(),a.anim.toEl=d,a.anim.fromEl=g):(t.css(d,f,9),n&&n())},scroll:function(e,n,a){var s=this,c=s.fromIndex,o=s.config,l=o.effect===v,u=s.viewSize[l?0:1]*s.activeIndex,f={};f[l?b:y]=-u+w,s.anim&&s.anim.stop(),a||c>-1?s.anim=new i(s.content,f,o.duration,o.easing,function(){s.anim=r,e&&e()}).run():(t.css(s.content,f),e&&e())}},s=a.Effects,s[v]=s[p]=s.scroll,a.addPlugin({priority:10,name:"effect",init:function(n){var i=n.config,a=i.effect,r=n.panels,s=n.content,u=i.steps,f=r[0],y=n.container,w=n.activeIndex;if(a!==l)switch(t.css(r,c,o),a){case v:case p:if(t.css(s,g,h),"static"==t.css(s.parentNode,g)&&t.css(s.parentNode,g,d),a===v&&(t.css(r,x,b),t.width(s,"999999px")),n.viewSize=[i.viewSize[0]||f&&t.outerWidth(f,!0)*u,i.viewSize[1]||f&&t.outerHeight(f,!0)*u],n.viewSize[0]||e.error("switchable must specify viewSize if there is no panels"),1==u&&f){var I=1,T=n.viewSize,_=f.parentNode.parentNode,k=[Math.min(t.width(y),t.width(_)),Math.min(t.height(y),t.height(_))];"scrollx"==a?I=Math.floor(k[0]/T[0]):"scrolly"==a&&(I=Math.floor(k[1]/T[1])),I>i.steps&&(n._realStep=I)}break;case m:var C,S=w*u,P=S+u-1;e.each(r,function(e,n){C=n>=S&&P>=n,t.css(e,{opacity:C?1:0,position:h,zIndex:C?9:1})})}}}),e.augment(a,{_switchView:function(t,n,i){var a=this,r=a.config,c=r.effect,o=e.isFunction(c)?c:s[c];o.call(a,function(){a._fireOnSwitch(n),i&&i.call(a)},t)}}),a},{requires:["dom","event","anim","./base"]}),KISSY.add("gallery/switchable/1.3/circular",function(e,t,n,i){function a(e){var i,a=this,r=a.fromIndex,s=a.config,c=a.length,l="scrollx"===s.scrollType,u=l?"left":"top",f=a.activeIndex,g=a.viewSize[l?0:1],d=a.panels,h={},v={},p=a._realStep,m=g*c;if(h[u]=-g*f,-1==r)return t.css(a.content,h),e&&e(),void 0;f+p>c?(v={position:"relative"},v[u]=m,i=f+p-c,t.css(d.slice(0,i),v),t.css(d.slice(i,p),o)):t.css(d.slice(0,p),o);var b=t.css(d[r],"position"),y=(r+c-f)%c,x=(f-r+c)%c;x>y&&"relative"==b?t.css(a.content,u,-(g*(c+r))):r==c-1&&0==f?t.css(a.content,u,g):t.css(a.content,u,-(g*r)),a.anim&&a.anim.stop(),a.anim=new n(a.content,h,s.duration,s.easing,function(){a.anim=0,e&&e()}).run()}function r(e,i){var a,r=this,o=r.fromIndex,l=r.config,u=r.length,f="scrollx"===l.scrollType,g=f?"left":"top",d=r.activeIndex,h=r.viewSize[f?0:1],v=-h*d,p=r.panels,m=r.config.steps,b={},y="backward"===i;a=y&&0===o&&d===u-1||!y&&o===u-1&&0===d,r.anim&&(r.anim.stop(),"relative"==p[o*m].style.position&&c.call(r,p,o,g,h,1)),a&&(v=s.call(r,p,d,g,h)),b[g]=v+"px",o>-1?r.anim=new n(r.content,b,l.duration,l.easing,function(){a&&c.call(r,p,d,g,h,1),r.anim=void 0,e&&e()}).run():(t.css(r.content,b),e&&e())}function s(e,n,i,a){var r,s=this,c=s.config,o=c.steps,l=s.length,u=n*o,f=(n+1)*o;return r=e.slice(u,f),t.css(r,"position","relative"),t.css(r,i,(n?-1:1)*a*l),n?a:-a*l}function c(e,n,i,a,r){var s,c=this,o=c.config,l=o.steps,u=c.length,f=n*l,g=(n+1)*l;s=e.slice(f,g),t.css(s,"position",""),t.css(s,i,""),r&&t.css(c.content,i,n?-a*(u-1):"")}var o={position:"",left:"",top:""};e.mix(i.Config,{circular:!1}),i.adjustPosition=s,i.resetPosition=c,i.addPlugin({name:"circular",priority:5,init:function(e){var t=e.config,n=t.effect;!t.circular||"scrollx"!==n&&"scrolly"!==n||(t.scrollType=n,t.effect=e._realStep?a:r)}})},{requires:["dom","anim","./base","./effect"]}),KISSY.add(function(e,t,n,i){function a(){this.stop&&this.stop()}function r(){this.start&&this.start()}i.addPlugin({name:"aria",init:function(e){if(e.config.aria){var t=e.container;n.on(t,"focusin",a,e),n.on(t,"focusout",r,e)}}});var s=["a","input","button","object"],c="oriTabIndex";return{setTabIndex:function(n,i){n.tabIndex=i,e.each(t.query("*",n),function(n){var a=n.nodeName.toLowerCase();e.inArray(a,s)&&(t.hasAttr(n,c)||t.attr(n,c,n.tabIndex),n.tabIndex=-1!=i?t.attr(n,c):i)})}}},{requires:["dom","event","./base"]}),KISSY.add("gallery/switchable/1.3/carousel/aria",function(e,t,n,i,a,r){function s(t){var n=this,i=n.config.steps,a=t.currentIndex,r=n.activeIndex,s=n.panels,c=s[a*i],o=n.triggers,l=o[a],u=t.originalEvent&&!(!t.originalEvent.target&&!t.originalEvent.srcElement);(u||-1==r)&&(e.each(o,function(e){I(e,-1)}),e.each(s,function(e){I(e,-1)}),l&&I(l,0),I(c,0),u&&c.focus())}function c(n){var i=null;return e.each(this.triggers,function(e){return e==n||t.contains(e,n)?(i=e,!1):void 0}),i}function o(e){var n=t.next(e),i=this.triggers;n||(n=i[0]),I(e,-1),n&&(I(n,0),n.focus())}function l(e){var n=t.prev(e),i=this.triggers;n||(n=i[i.length-1]),I(e,-1),n&&(I(n,0),n.focus())}function u(t){var n,i=t.keyCode,a=this,r=t.target;switch(i){case y:case b:n=c.call(a,r),n&&(o.call(a,n),t.halt());break;case m:case p:n=c.call(a,r),n&&(l.call(a,n),t.halt());break;case w:case x:n=c.call(a,r),n&&(a.switchTo(e.indexOf(n,a.triggers),void 0,T),t.halt())}}function f(n){var i=null;return e.each(this.panels,function(e){return e==n||t.contains(e,n)?(i=e,!1):void 0}),i}function g(e){var n=this,i=t.next(e),a=n.panels;i||(i=a[0]),I(e,-1),I(i,0),h.call(n,i,_)&&i.focus()}function d(e){var n=t.prev(e),i=this,a=i.panels;n||(n=a[a.length-1]),I(e,-1),I(n,0),h.call(i,n,k)&&n.focus()}function h(t,n){var i=this,a=e.indexOf(t,i.panels),r=i.config.steps,s=Math.floor(a/r);return s==i.activeIndex?1:0==a%r||a%r==r-1?(i.switchTo(s,n,T),0):1}function v(e){var t,n=this,i=e.keyCode,a=e.target;switch(i){case y:case b:t=f.call(n,a),t&&(g.call(n,t),e.halt());break;case m:case p:t=f.call(n,a),t&&(d.call(n,t),e.halt());break;case w:case x:t=f.call(n,a),t&&(n.fire("itemSelected",{item:t}),e.halt())}}var p=37,m=38,b=39,y=40,x=32,w=13,I=i.setTabIndex,T={originalEvent:{target:1}},_="forward",k="backward";e.mix(a.Config,{aria:!1}),r.addPlugin({name:"aria",init:function(t){if(t.config.aria){var i=t.triggers,a=t.panels,r=t.content,c=t.activeIndex;r.id||(r.id=e.guid("ks-switchbale-content")),r.setAttribute("role","listbox");var o=0;e.each(i,function(e){I(e,c==o?"0":"-1"),e.setAttribute("role","button"),e.setAttribute("aria-controls",r.id),o++}),o=0,e.each(a,function(e){I(e,"-1"),e.setAttribute("role","option"),o++}),t.on("switch",s,t);var l=t.nav;l&&n.on(l,"keydown",u,t),n.on(r,"keydown",v,t);var f=t.prevBtn,g=t.nextBtn;f&&(I(f,0),f.setAttribute("role","button"),n.on(f,"keydown",function(e){(e.keyCode==w||e.keyCode==x)&&(t.prev(T),e.preventDefault())})),g&&(I(g,0),g.setAttribute("role","button"),n.on(g,"keydown",function(e){(e.keyCode==w||e.keyCode==x)&&(t.next(T),e.preventDefault())}))}}},a)},{requires:["dom","event","../aria","./base","../base"]}),KISSY.add("gallery/switchable/1.3/autoplay",function(e,t,n,i,a){var r=200,s=e.Env.host,c=function(e){var n=t.scrollTop(),i=t.viewportHeight(),a=t.offset(e),r=t.height(e);return a.top>n&&n+i>a.top+r};return e.mix(i.Config,{pauseOnScroll:!1,autoplay:!1,interval:5,pauseOnHover:!0}),i.addPlugin({name:"autoplay",init:function(t){function i(){o=e.later(function(){t.paused||t.next()},u,!0)}var o,l=t.config,u=1e3*l.interval;l.autoplay&&(l.pauseOnScroll&&(t.__scrollDetect=e.buffer(function(){t[c(t.container)?"start":"stop"]()},r),n.on(s,"scroll",t.__scrollDetect)),i(),t.stop=function(){o&&(o.cancel(),o=a),t.paused=!0},t.start=function(){o&&(o.cancel(),o=a),t.paused=!1,i()},l.pauseOnHover&&(n.on(t.container,"mouseenter",t.stop,t),n.on(t.container,"mouseleave",t.start,t)))},destroy:function(e){e.__scrollDetect&&(n.remove(s,"scroll",e.__scrollDetect),e.__scrollDetect.stop())}}),i},{requires:["dom","event","./base"]}),KISSY.add("gallery/switchable/1.3/tabs/aria",function(e,t,n,i,a,r){function s(n){var i=this.triggers,a=null;return e.each(i,function(e){(e==n||t.contains(e,n))&&(a=e)}),a}function c(e){switch(e.keyCode){case u:case f:!e.ctrlKey||e.altKey||e.shiftKey||e.halt();break;case m:e.ctrlKey&&!e.altKey&&e.halt()}}function o(e){var t=e.target,n=this,i=e.ctrlKey&&!e.shiftKey&&!e.altKey;switch(e.keyCode){case d:case h:s.call(n,t)&&(n.prev(y(e)),e.halt());break;case v:case p:s.call(n,t)&&(n.next(y(e)),e.halt());break;case f:i&&(e.halt(),n.next(y(e)));break;case u:i&&(e.halt(),n.prev(y(e)));break;case m:e.ctrlKey&&!e.altKey&&(e.halt(),e.shiftKey?n.prev(y(e)):n.next(y(e)))}}function l(e){var t=e.originalEvent&&!(!e.originalEvent.target&&!e.originalEvent.srcElement),n=this,i=e.fromIndex,a=e.currentIndex;if(i!=a){var r=n.triggers[i],s=n.triggers[a],c=n.panels[i],o=n.panels[a];if(r&&b(r,"-1"),b(s,"0"),t)try{s.focus()}catch(l){}c&&c.setAttribute("aria-hidden","true"),o.setAttribute("aria-hidden","false")}}var u=33,f=34,g="added",d=37,h=38,v=39,p=40,m=9;e.mix(r.Config,{aria:!0}),i.addPlugin({name:"aria",init:function(i){function a(t){t.setAttribute("role","tab"),b(t,"-1"),t.id||(t.id=e.guid("ks-switchable"))}function r(e,t){e.setAttribute("role","tabpanel"),e.setAttribute("aria-hidden","true"),e.setAttribute("aria-labelledby",t.id)}if(i.config.aria){var s=i.triggers,u=i.activeIndex,f=i.panels,d=i.container;i.nav&&t.attr(i.nav,"role","tablist");var h=0;e.each(s,a),i.on(g,function(e){var t;a(t=e.trigger),r(e.panel,t)}),h=0,e.each(f,function(e){var t=s[h];r(e,t),h++}),u>-1&&(b(s[u],"0"),f[u].setAttribute("aria-hidden","false")),i.on("switch",l,i),n.on(d,"keydown",o,i),n.on(d,"keypress",c,i)}}},r);var b=a.setTabIndex,y=i.getDomEvent},{requires:["dom","event","../base","../aria","./base"]}),KISSY.add("gallery/switchable/1.3/accordion/aria",function(e,t,n,i,a,r){function s(n){var i=this.triggers,a=null;return e.each(i,function(e){(e==n||t.contains(e,n))&&(a=e)}),a}function c(n){var i=this.panels,a=null;return e.each(i,function(e){(e==n||t.contains(e,n))&&(a=e)}),a}function o(t){var n=this,i=n.triggers,a=n.panels;return i[e.indexOf(t,a)]}function l(e){var t=this,n=s.call(t,e);return n||(n=o.call(t,c.call(t,e))),n}function u(e){switch(e.keyCode){case b:case y:!e.ctrlKey||e.altKey||e.shiftKey||e.halt();break;case C:e.ctrlKey&&!e.altKey&&e.halt()}}function f(e){var t,n=e.target,i=this,a=i.triggers,r=!e.ctrlKey&&!e.shiftKey&&!e.altKey,c=e.ctrlKey&&!e.shiftKey&&!e.altKey;switch(e.keyCode){case P:case S:(t=s.call(i,n))&&r&&(p.call(i,t),e.halt());break;case I:case T:(t=s.call(i,n))&&(d.call(i,t),e.halt());break;case _:case k:(t=s.call(i,n))&&(v.call(i,t),e.halt());break;case y:c&&(e.halt(),t=l.call(i,n),v.call(i,t));break;case b:c&&(e.halt(),t=l.call(i,n),d.call(i,t));break;case w:r&&(t=l.call(i,n),h.call(i,0),e.halt());break;case x:r&&(t=l.call(i,n),h.call(i,a.length-1),e.halt());break;case C:e.ctrlKey&&!e.altKey&&(e.halt(),t=l.call(i,n),e.shiftKey?d.call(i,t):v.call(i,t))}}function g(n,i){var a=this,r=a.triggers,s=r[n];if(e.each(r,function(e){e!==s&&(K(e,"-1"),t.removeClass(e,"ks-switchable-select"),e.setAttribute("aria-selected","false"))}),i)try{s.focus()}catch(c){}K(s,"0"),t.addClass(s,"ks-switchable-select"),s.setAttribute("aria-selected","true")}function d(t){var n=this,i=n.triggers,a=e.indexOf(t,i),r=0==a?i.length-1:a-1;g.call(n,r,!0)}function h(e){g.call(this,e,!0)}function v(t){var n=this,i=n.triggers,a=e.indexOf(t,i),r=a==i.length-1?0:a+1;g.call(n,r,!0)}function p(t){var n=this;n.switchTo(e.indexOf(t,n.triggers))}function m(t){var n=t.originalEvent&&!(!t.originalEvent.target&&!t.originalEvent.srcElement),i=this,a=i.config.multiple,r=t.currentIndex,s=i.panels,c=i.triggers,o=c[r],l=s[r];a||(e.each(s,function(e){e!==l&&e.setAttribute("aria-hidden","true")}),e.each(c,function(e){e!==o&&e.setAttribute("aria-hidden","true")}));var u=l.getAttribute("aria-hidden");l.setAttribute("aria-hidden","false"==u?"true":"false"),o.setAttribute("aria-expanded","false"==u?"false":"true"),g.call(i,r,n)}var b=33,y=34,x=35,w=36,I=37,T=38,_=39,k=40,C=9,S=32,P=13;e.mix(a.Config,{aria:!0}),r.addPlugin({name:"aria",init:function(i){if(i.config.aria){var a=i.container,r=i.activeIndex;t.attr(a,"aria-multiselectable",i.config.multiple?"true":"false"),i.nav&&t.attr(i.nav,"role","tablist");var s=i.triggers,c=i.panels,o=0;e.each(c,function(t){t.id||(t.id=e.guid("ks-accordion-tab-panel"))}),e.each(s,function(t){t.id||(t.id=e.guid("ks-accordion-tab"))}),e.each(s,function(e){e.setAttribute("role","tab"),e.setAttribute("aria-expanded",r==o?"true":"false"),e.setAttribute("aria-selected",r==o?"true":"false"),e.setAttribute("aria-controls",c[o].id),K(e,r==o?"0":"-1"),o++}),o=0,e.each(c,function(e){var t=s[o];e.setAttribute("role","tabpanel"),e.setAttribute("aria-hidden",r==o?"false":"true"),e.setAttribute("aria-labelledby",t.id),o++}),i.on("switch",m,i),n.on(a,"keydown",f,i),n.on(a,"keypress",u,i)}}},a);var K=i.setTabIndex},{requires:["dom","event","../aria","./base","../base"]}),KISSY.add("gallery/switchable/1.3/touch",function(e,t,n,i,a){e.mix(i.Config,{mouseAsTouch:!1}),i.addPlugin({name:"touch",init:function(n){function r(){return"relative"==n.panels[n.activeIndex].style.position?(w.stopDrag(),void 0):(n.stop&&n.stop(),b=t.offset(p),y=c(m),void 0)}function s(e,t,n){return e>=t&&n>=e}function c(e){var n=t.offset(e);return n.bottom=n.top+m.offsetHeight,n.right=n.left+m.offsetWidth,n}function o(e){var a,r={};if("scrolly"==f?(v=n.viewSize[1],h=e.pageY-d,r.top=b.top+h,a=s(e.pageY,y.top,y.bottom)):(v=n.viewSize[0],h=e.pageX-g,r.left=b.left+h,a=s(e.pageX,y.left,y.right)),n.anim&&(n.anim.stop(),n.anim=void 0),a){if(u.circular){var c=n.activeIndex,o=n.length-1;c==o?i.adjustPosition.call(n,n.panels,0,x,v):0==c&&i.adjustPosition.call(n,n.panels,o,x,v)}t.offset(p,r)}else w.stopDrag()}function l(){var e=n.activeIndex,t=n.length-1;return!u.circular&&(0>h&&e==t||h>0&&0==e)?(i.Effects[f].call(n,void 0,void 0,!0),void 0):(0>h&&e==t||h>0&&0==e||(0==e||e==t)&&i.resetPosition.call(n,n.panels,0==e?t:0,x,v),n[0>h?"next":"prev"](),n.start&&n.start(),void 0)}if(!n._realStep){var u=n.config,f=u.scrollType||u.effect;if("scrolly"==f||"scrollx"==f){var g,d,h,v,p=n.content,m=n.container,b={},y={},x="left";if("scrolly"==f&&(x="top"),u.mouseAsTouch&&(a=e.require("dd/base")),a){var w=new a.Draggable({node:p,groups:!1});w.on("dragstart",function(){r(),g=w.get("startMousePos").left,d=w.get("startMousePos").top}),w.on("drag",o),w.on("dragend",l),n.__touchDD=w}}}},destroy:function(e){var t;(t=e.__touchDD)&&t.destroy()}})},{requires:["dom","event","./base",KISSY.Features.isTouchSupported()?"dd/base":""]}),KISSY.add("gallery/switchable/1.3/index",function(e,t,n,i,a,r){var s={Accordion:n,Carousel:i,Slide:a,Tabs:r};return e.mix(t,s),t},{requires:["./base","./accordion/base","./carousel/base","./slide/base","./tabs/base","./lazyload","./effect","./circular","./carousel/aria","./autoplay","./aria","./tabs/aria","./accordion/aria","./touch"]});